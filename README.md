# Video Pose Repetition Labeller

A simple and intuitive GUI application for annotating exercise repetition segments in videos using JSON keypoint data generated by [RepJudge](https://github.com/fanlimua/RepJudge).

## Overview

This tool provides a streamlined workflow for manually labeling exercise repetition phases in videos. It reads JSON keypoint files generated by the RepJudge project and allows you to annotate temporal segments corresponding to different states of exercise repetitions.

## Features

- **Simple Video Navigation**: Frame-by-frame control with play/pause and slider
- **JSON Integration**: Reads pose keypoint data from RepJudge output files
- **Structured Labeling**: Predefined state sequence based on binary repetition labels
- **Batch Processing**: Load and annotate multiple samples from organized directories
- **Persistent Annotations**: Save labels back to JSON files for further analysis

## Exercise State Sequence

The application generates a state sequence based on a binary label (e.g., "1010"):
- **prep** - Preparation phase before exercise starts
- **rep** - Active repetition phase (when binary digit is '1')
- **no-rep** - Inactive/transition phase (when binary digit is '0') 
- **finish** - Completion phase after exercise ends

For binary label "1010", the sequence would be: `prep → rep → no-rep → rep → no-rep → finish`

## Installation

### Prerequisites

- Python 3.8+
- OpenCV (for video processing)
- Pillow (for image handling)
- tkinter (usually included with Python)

### Setup

1. Clone this repository:
   ```bash
   git clone https://github.com/lc-leonardo/RepLabeler.git
   cd RepLabeler
   ```

2. Install dependencies:
   ```bash
   pip install -r requirements.txt
   ```

3. Run the application:
   ```bash
   python video_pose_labeler.py
   ```
   Or use the launch script:
   ```bash
   ./launch.sh
   ```

## Usage

### 1. Directory Structure
Ensure your data follows this structure (as generated by RepJudge):
```
project_root/
├── json_keypoints/          # Pose keypoint JSON files
│   ├── exercise_type_1/
│   │   ├── sample_001/
│   │   │   └── *.json
│   │   └── sample_002/
│   └── exercise_type_2/
└── videos/                  # Corresponding video files
    ├── sample_001.mp4
    └── sample_002.mp4
```

### 2. Loading Data
1. Click "Select json_keypoints folder..." and choose your `json_keypoints` directory
2. Select an exercise type from the left panel
3. Select a specific sample
4. Double-click or click "Load selected sample"

### 3. Providing Binary Labels
- If the JSON doesn't contain a `binary_label` field, you'll be prompted to enter one
- Enter a string of 0s and 1s representing rep/no-rep phases (e.g., "1010")
- This generates the state sequence for annotation

### 4. Annotating Videos
1. Use video controls to navigate:
   - **Play/Pause**: Start/stop video playback  
   - **Frame buttons**: Step forward/backward by single frames
   - **Slider**: Jump to specific frames

2. Mark state boundaries:
   - Position the video at the **end** of the current state
   - Click "Mark end of current state"
   - Progress through: prep → rep/no-rep phases → finish

3. Edit annotations:
   - **Undo last mark**: Remove the most recent annotation
   - **Clear annotations**: Start over with a clean slate

### 5. Saving Results
- Complete all states before saving (prep + all rep/no-rep + finish)
- Click "Save annotations" to write labels back to JSON files
- Annotations are saved across all JSON files for the sample

## JSON Format

The tool reads and writes to JSON files with this structure:
```json
{
  "video_path": "path/to/video.mp4",
  "binary_label": "1010", 
  "keypoints": [...],
  "annotations": [
    {"start": 0, "end": 50, "label": "prep"},
    {"start": 51, "end": 120, "label": "rep"},
    {"start": 121, "end": 180, "label": "no-rep"},
    {"start": 181, "end": 240, "label": "rep"},
    {"start": 241, "end": 300, "label": "no-rep"},
    {"start": 301, "end": 350, "label": "finish"}
  ]
}
```

## Integration with RepJudge

This tool is designed to work seamlessly with the [RepJudge](https://github.com/fanlimua/RepJudge) project:

1. **Run RepJudge** on your exercise videos to generate pose keypoints and initial JSON files
2. **Use this labeller** to add temporal annotations for repetition phases
3. **Analyze results** using the enriched JSON files with both pose data and repetition labels

## Requirements

See `requirements.txt` for specific package versions.

## Contributing

This is a simple, focused tool. Contributions are welcome for bug fixes and small improvements that maintain the tool's simplicity.

## License

This project is provided as-is for research and educational purposes.

## Support

For issues and questions:
1. Check this documentation
2. Review the console output for error messages
3. Open an issue in the RepJudge repository